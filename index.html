<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CRM Financiero v2.6.1 - Fix Editar</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <style>
        :root {
            --primary: #4f46e5;
            --primary-light: #818cf8;
            --secondary: #1e1b4b;
            --bg-body: #f3f4f6;
            --surface: #ffffff;
            --text-main: #1f2937;
            --text-light: #6b7280;
            
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --credit: #ec4899;
            
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --radius: 16px;
            --nav-width: 260px;
            --header-height: 70px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
            display: flex;
        }

        /* --- SIDEBAR (Desktop) --- */
        .sidebar {
            width: var(--nav-width);
            background: var(--surface);
            height: 100vh;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #e5e7eb;
            position: fixed;
            left: 0; top: 0;
            z-index: 50;
            transition: transform 0.3s ease;
        }

        .brand {
            height: var(--header-height);
            display: flex; align-items: center; padding: 0 24px;
            font-size: 1.25rem; font-weight: 800; color: var(--primary);
            border-bottom: 1px solid #f3f4f6;
        }
        .brand i { margin-right: 10px; font-size: 1.5rem; }

        .nav-links { flex: 1; padding: 20px 12px; display: flex; flex-direction: column; gap: 8px; }
        
        .nav-item {
            padding: 12px 16px; border-radius: 12px;
            color: var(--text-light); font-weight: 500; cursor: pointer;
            display: flex; align-items: center; gap: 12px;
            transition: all 0.2s;
        }
        .nav-item:hover { background: #f9fafb; color: var(--primary); }
        .nav-item.active { background: #e0e7ff; color: var(--primary); font-weight: 600; }
        .nav-item i { width: 24px; text-align: center; }

        /* --- MAIN CONTENT AREA --- */
        .main-wrapper {
            flex: 1;
            margin-left: var(--nav-width);
            height: 100vh;
            overflow-y: auto;
            position: relative;
            padding-bottom: 80px;
        }

        .top-header {
            height: var(--header-height);
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(10px);
            position: sticky; top: 0; z-index: 40;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 24px; border-bottom: 1px solid #e5e7eb;
        }
        .page-title { font-size: 1.2rem; font-weight: 700; color: var(--text-main); }
        
        .date-filter-pill {
            background: white; border: 1px solid #e5e7eb; padding: 6px 12px;
            border-radius: 20px; font-size: 0.9rem; display: flex; align-items: center; gap: 8px;
            box-shadow: var(--shadow-sm);
        }
        .date-filter-pill input { border: none; outline: none; font-weight: 600; color: var(--primary); font-family: inherit; }

        .content-container { padding: 24px; max-width: 1200px; margin: 0 auto; }

        /* --- CARDS & WIDGETS --- */
        .card {
            background: var(--surface); border-radius: var(--radius);
            padding: 24px; margin-bottom: 24px;
            box-shadow: var(--shadow-sm); border: 1px solid #f3f4f6;
        }

        .hero-balance {
            background: linear-gradient(135deg, var(--primary) 0%, #4338ca 100%);
            color: white; padding: 30px; border-radius: var(--radius);
            box-shadow: 0 10px 20px -5px rgba(79, 70, 229, 0.4);
            margin-bottom: 24px; position: relative; overflow: hidden;
        }
        .hero-balance::after {
            content: ''; position: absolute; right: -20px; top: -20px;
            width: 150px; height: 150px; background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }
        .hero-title { font-size: 0.9rem; opacity: 0.9; margin-bottom: 5px; }
        .hero-amount { font-size: 2.5rem; font-weight: 800; letter-spacing: -1px; }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px; }
        
        .mini-stat {
            background: white; padding: 20px; border-radius: var(--radius);
            box-shadow: var(--shadow-sm); border: 1px solid #f3f4f6;
            display: flex; flex-direction: column; justify-content: center;
        }
        .mini-label { font-size: 0.85rem; color: var(--text-light); margin-bottom: 4px; display: flex; align-items: center; gap: 6px; }
        .mini-value { font-size: 1.25rem; font-weight: 700; color: var(--text-main); }
        .mini-stat.debt .mini-value { color: var(--danger); }
        .mini-stat.income .mini-value { color: var(--success); }

        /* --- FAB --- */
        .fab {
            position: fixed; bottom: 30px; right: 30px;
            width: 60px; height: 60px; border-radius: 50%;
            background: var(--primary); color: white;
            display: flex; justify-content: center; align-items: center;
            font-size: 1.5rem; box-shadow: 0 4px 15px rgba(79, 70, 229, 0.4);
            cursor: pointer; z-index: 100; transition: transform 0.2s; border: none;
        }
        .fab:hover { transform: scale(1.1); }
        .fab:active { transform: scale(0.95); }

        /* --- MOBILE BOTTOM NAV --- */
        .mobile-nav {
            display: none; position: fixed; bottom: 0; left: 0; width: 100%;
            background: white; height: 65px; border-top: 1px solid #eee;
            z-index: 90; justify-content: space-around; align-items: center;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .mob-link {
            flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100%; color: #9ca3af; font-size: 0.75rem; gap: 4px; background: none; border: none; cursor: pointer;
        }
        .mob-link i { font-size: 1.2rem; }
        .mob-link.active { color: var(--primary); font-weight: 600; }

        /* --- RESPONSIVE DESIGN --- */
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .main-wrapper { margin-left: 0; padding-bottom: 90px; }
            .mobile-nav { display: flex; }
            .fab { bottom: 85px; right: 20px; }
            .content-container { padding: 16px; }
            .hero-amount { font-size: 2rem; }
            .top-header { padding: 0 16px; }
        }

        /* --- FORM STYLES --- */
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .form-group { display: flex; flex-direction: column; margin-bottom: 15px; }
        .form-group.full-width { grid-column: 1 / -1; }
        label { font-size: 0.85rem; font-weight: 600; margin-bottom: 6px; color: var(--text-main); }
        input, select {
            padding: 12px; border: 1px solid #d1d5db; border-radius: 10px;
            font-size: 1rem; background: #f9fafb; outline: none; transition: border 0.2s;
        }
        input:focus, select:focus { border-color: var(--primary); background: white; box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1); }
        
        button { border: none; font-family: inherit; cursor: pointer; }
        .btn-primary { background: var(--primary); color: white; padding: 12px 24px; border-radius: 10px; font-weight: 600; width: 100%; }
        .btn-cancel { background: #e5e7eb; color: var(--text-main); padding: 12px 24px; border-radius: 10px; font-weight: 600; }

        /* UTILS */
        .hidden { display: none !important; }
        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Table & Lists */
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        th { text-align: left; padding: 16px; color: var(--text-light); font-weight: 600; border-bottom: 1px solid #eee; }
        td { padding: 16px; border-bottom: 1px solid #f3f4f6; }
        .btn-icon-action { background: none; border: none; cursor: pointer; font-size: 1.1rem; padding: 5px; margin-right: 5px; transition: transform 0.2s; }
        .btn-icon-action:hover { transform: scale(1.1); }

        /* Specific Colors */
        .text-success { color: var(--success); font-weight: 600; }
        .text-danger { color: var(--danger); font-weight: 600; }
        .text-credit { color: var(--credit); font-weight: 600; }
        
        /* Loading */
        .loading { display: flex; justify-content: center; padding: 40px; }
        .spinner { width: 30px; height: 30px; border: 3px solid #e5e7eb; border-top-color: var(--primary); border-radius: 50%; animation: spin 1s infinite linear; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Modals */
        .modal-overlay { z-index: 2000; }
        .modal-content {
            background: white; padding: 30px; border-radius: 16px; width: 90%; max-width: 600px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); animation: slideUp 0.3s ease-out;
            max-height: 90vh; overflow-y: auto;
        }
        .modal-title { font-size: 1.3rem; font-weight: bold; margin-bottom: 15px; }
        .modal-details { margin-bottom: 20px; background: #f9fafb; padding: 15px; border-radius: 8px; }
        .modal-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.95rem; }
        .modal-actions { display: flex; gap: 10px; margin-top: 20px; }
        .btn-confirm { background: var(--credit); color: white; flex: 1; padding: 10px; border-radius: 8px; font-weight: bold;}

        /* Quota Cards */
        .quota-card {
            border: 1px solid #eee; padding: 15px; border-radius: 12px; margin-bottom: 10px;
            display: flex; flex-direction: column; gap: 5px;
        }
        .quota-header { display: flex; justify-content: space-between; font-weight: bold; color: var(--text-main); }
        .quota-details { display: flex; justify-content: space-between; font-size: 0.85rem; color: var(--text-light); }
        
        .card-status-item { margin-bottom: 10px; padding: 15px; background: #fff; border-radius: 12px; border: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .card-status-item .card-name { font-weight: 600; }
        .card-status-item .card-debt { color: var(--danger); font-weight: 700; }

        .toast { position: fixed; bottom: 20px; right: 20px; padding: 15px 25px; border-radius: 8px; color: white; z-index: 3000; }
        .toast.success { background: var(--success); }
        .toast.error { background: var(--danger); }
    </style>
</head>
<body>

    <!-- SIDEBAR (Desktop) -->
    <nav class="sidebar">
        <div class="brand">
            <i class="fas fa-wallet"></i> CRM v2.6.1
        </div>
        <div class="nav-links">
            <div class="nav-item active" onclick="switchView('dashboard', this)">
                <i class="fas fa-home"></i> Dashboard
            </div>
            <div class="nav-item" onclick="switchView('transacciones', this)">
                <i class="fas fa-exchange-alt"></i> Transacciones
            </div>
            <div class="nav-item" onclick="switchView('estadisticas', this)">
                <i class="fas fa-chart-pie"></i> EstadÃ­sticas
            </div>
            <div class="nav-item" onclick="switchView('historial', this)">
                <i class="fas fa-list"></i> Historial
            </div>
        </div>
        <div style="padding: 24px; font-size: 0.75rem; color: #9ca3af; text-align: center;">
            Familia & Finanzas Â© 2025
        </div>
    </nav>

    <!-- MOBILE BOTTOM NAV -->
    <nav class="mobile-nav">
        <button class="mob-link active" onclick="switchView('dashboard', this)">
            <i class="fas fa-home"></i> <span>Inicio</span>
        </button>
        <button class="mob-link" onclick="switchView('transacciones', this)">
            <i class="fas fa-exchange-alt"></i> <span>Trans.</span>
        </button>
        <button class="mob-link" onclick="switchView('estadisticas', this)">
            <i class="fas fa-chart-pie"></i> <span>Stats</span>
        </button>
        <button class="mob-link" onclick="switchView('historial', this)">
            <i class="fas fa-list"></i> <span>Hist.</span>
        </button>
    </nav>

    <!-- FLOATING ACTION BUTTON (FAB) -->
    <button class="fab" onclick="goToAddTransaction()">
        <i class="fas fa-plus"></i>
    </button>

    <!-- MAIN CONTENT -->
    <div class="main-wrapper">
        <!-- Sticky Top Header -->
        <header class="top-header">
            <div class="page-title" id="pageTitle">Resumen Financiero</div>
            <!-- Global Date Filter inside Header -->
            <div class="date-filter-pill">
                <i class="far fa-calendar-alt" style="color: var(--primary);"></i>
                <input type="month" id="dashboardMonth" onchange="updateDashboardView()">
            </div>
        </header>

        <div class="content-container">
            
            <!-- VIEW: DASHBOARD -->
            <div id="view-dashboard" class="tab-content active">
                
                <!-- Hero Card: Total Balance -->
                <div class="hero-balance">
                    <div class="hero-title">Patrimonio LÃ­quido Total</div>
                    <div class="hero-amount" id="saldoTotal">$ 0</div>
                    <div style="font-size: 0.85rem; margin-top: 10px; opacity: 0.8;">
                        <i class="fas fa-info-circle"></i> Suma de Nequi, Bancos y Efectivo
                    </div>
                </div>

                <!-- Mini Stats Row -->
                <div class="stats-grid">
                    <div class="mini-stat">
                        <div class="mini-label"><i class="fas fa-university" style="color: #6366f1;"></i> DÃ©bito</div>
                        <div class="mini-value" id="saldoDebito">$0</div>
                    </div>
                    <div class="mini-stat">
                        <div class="mini-label"><i class="fas fa-money-bill-wave" style="color: #10b981;"></i> Efectivo</div>
                        <div class="mini-value" id="saldoEfectivo">$0</div>
                    </div>
                    <div class="mini-stat">
                        <div class="mini-label"><i class="fas fa-mobile-alt" style="color: #ec4899;"></i> Nequi</div>
                        <div class="mini-value" id="saldoNequi">$0</div>
                    </div>
                </div>

                <!-- Monthly Flow -->
                <h3 style="margin-bottom: 15px; color: var(--text-light); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">Flujo del Mes (<span id="lblPeriodoResumen">Actual</span>)</h3>
                <div class="stats-grid">
                    <div class="mini-stat income">
                        <div class="mini-label">Ingresos</div>
                        <div class="mini-value" id="totalIngresosMes">$0</div>
                    </div>
                    <div class="mini-stat debt">
                        <div class="mini-label">Gastos + Compras TC</div>
                        <div class="mini-value" id="totalGastosMes">$0</div>
                    </div>
                    <div class="mini-stat">
                        <div class="mini-label">Balance Neto</div>
                        <div class="mini-value" id="balanceMes" style="color: var(--primary);">$0</div>
                    </div>
                </div>

                <!-- Credit Cards Section -->
                <div class="card">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
                        <h3 style="margin:0;"><i class="fas fa-credit-card"></i> Deudas Tarjetas</h3>
                        <button onclick="openQuotaModal()" style="background: var(--bg-body); color: var(--text-main); padding: 8px 12px; border-radius: 8px; font-size: 0.8rem; width: auto;">
                            <i class="fas fa-cog"></i> Gestionar
                        </button>
                    </div>
                    
                    <div class="hero-amount" id="deudaTotalTC" style="color: var(--danger); font-size: 1.8rem; margin-bottom: 15px;">$0</div>
                    
                    <div id="cardsBreakdown">
                        <div class="loading"><div class="spinner"></div></div>
                    </div>
                </div>
            </div>

            <!-- VIEW: TRANSACCIONES (Form) -->
            <div id="view-transacciones" class="tab-content">
                <div class="card">
                    <h2 style="margin-bottom: 20px;" id="formTitle">Nueva TransacciÃ³n</h2>
                    <form id="transactionForm">
                        <input type="hidden" id="editingId" value="">

                        <div class="form-grid">
                            <div class="form-group full-width">
                                <label>Tipo de Movimiento</label>
                                <select id="tipo" required onchange="handleTipoChange()" style="font-weight: 600;">
                                    <option value="gasto">ðŸ’¸ Gasto (Salida Dinero)</option>
                                    <option value="ingreso">ðŸ’° Ingreso (Entrada Dinero)</option>
                                    <option value="credito">ðŸ’³ Compra a CrÃ©dito (Genera Deuda)</option>
                                    <option value="pago_tarjeta">ðŸ“‰ Pagar Tarjeta (Baja Deuda)</option>
                                    <option value="transferencia">ðŸ”„ Transferencia entre Cuentas</option>
                                </select>
                            </div>

                            <!-- Bloques Condicionales (Credito / Pago) -->
                            <div id="creditConfig" class="form-group full-width hidden" style="background: #fff1f2; padding: 15px; border-radius: 12px; border: 1px solid #fda4af;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                    <div class="form-group">
                                        <label style="color: var(--danger);">Tarjeta</label>
                                        <select id="tarjetaCredito"></select>
                                    </div>
                                    <div class="form-group">
                                        <label style="color: var(--danger);">Cuotas</label>
                                        <input type="number" id="cuotas" min="1" max="36" value="1">
                                    </div>
                                </div>
                            </div>

                            <div id="divPagoTarjeta" class="form-group full-width hidden" style="background: #ecfdf5; padding: 15px; border-radius: 12px; border: 1px solid #6ee7b7;">
                                <div class="form-group">
                                    <label style="color: var(--success);">Tarjeta a Pagar</label>
                                    <select id="tarjetaDestinoPago"></select>
                                </div>
                            </div>

                            <div class="form-group" id="metodoPagoDiv">
                                <label id="lblMetodoPago">MÃ©todo de Pago</label>
                                <select id="metodoPago">
                                    <option value="debito">DÃ©bito</option>
                                    <option value="efectivo">Efectivo</option>
                                    <option value="nequi">Nequi</option>
                                </select>
                            </div>

                            <div class="form-group hidden" id="metodoDestinoDiv">
                                <label>Cuenta Destino</label>
                                <select id="metodoDestino">
                                    <option value="debito">DÃ©bito</option>
                                    <option value="efectivo">Efectivo</option>
                                    <option value="nequi">Nequi</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Monto</label>
                                <input type="text" id="monto" placeholder="$ 0" required oninput="formatCurrencyInput(this)" style="font-size: 1.2rem; font-weight: bold; color: var(--primary);">
                            </div>

                            <div class="form-group">
                                <label>CategorÃ­a</label>
                                <select id="categoria" required><option value="">Seleccione...</option></select>
                            </div>

                            <div class="form-group hidden" id="subcategoriaDiv">
                                <label>SubcategorÃ­a</label>
                                <select id="subcategoria"></select>
                            </div>

                            <div class="form-group">
                                <label>Responsable</label>
                                <select id="miembro" required>
                                    <option value="papa">PapÃ¡</option>
                                    <option value="mama">MamÃ¡</option>
                                    <option value="hijo1">Hijo/a 1</option>
                                    <option value="compartido">Compartido</option>
                                </select>
                            </div>

                            <div class="form-group full-width">
                                <label>DescripciÃ³n</label>
                                <input type="text" id="descripcion" placeholder="Â¿En quÃ© gastaste?" required>
                            </div>

                            <div class="form-group">
                                <label>Fecha</label>
                                <input type="date" id="fecha" required>
                            </div>
                        </div>

                        <div style="margin-top: 25px; display: flex; gap: 10px;">
                            <button type="button" onclick="preSubmit()" class="btn-primary" id="btnSubmitText">Guardar TransacciÃ³n</button>
                            <button type="button" id="btnCancelar" class="btn-cancel hidden" onclick="cancelEdit()">Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- VIEW: ESTADISTICAS -->
            <div id="view-estadisticas" class="tab-content">
                <div class="card">
                    <h3>Tendencia Financiera (6 Meses)</h3>
                    <div style="height: 300px; position: relative;">
                        <canvas id="chartTendencias"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h3>DistribuciÃ³n de Gastos</h3>
                    <div style="height: 350px; position: relative;">
                        <canvas id="chartCategorias"></canvas>
                    </div>
                </div>
            </div>

            <!-- VIEW: HISTORIAL -->
            <div id="view-historial" class="tab-content">
                <div class="card">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Tipo</th>
                                    <th>CategorÃ­a</th>
                                    <th>Desc.</th>
                                    <th>Monto</th>
                                    <th>AcciÃ³n</th>
                                </tr>
                            </thead>
                            <tbody id="transactionList"></tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div> <!-- End Content Container -->
    </div> <!-- End Main Wrapper -->

    <!-- --- MODALES (Ocultos por defecto) --- -->
    
    <!-- Modal SimulaciÃ³n CrÃ©dito -->
    <div class="modal-overlay hidden" id="creditModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center;">
        <div class="modal-content">
            <h3 class="modal-title">Confirmar CrÃ©dito</h3>
            <div class="modal-details" style="margin-top:15px;">
                <div class="modal-row"><span>Tarjeta:</span><strong id="modalTarjeta">-</strong></div>
                <div class="modal-row"><span>Cuotas:</span><span id="modalCuotas">0</span></div>
                <div class="modal-row total"><span>Total Deuda:</span><span id="modalTotalDeuda">$0</span></div>
            </div>
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeModal('creditModal')">Volver</button>
                <button class="btn-confirm" onclick="confirmSaveTransaction()">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Modal GestiÃ³n Tarjetas -->
    <div class="modal-overlay hidden" id="quotaModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center;">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h3 class="modal-title">GestiÃ³n Tarjetas</h3>
                <button onclick="closeModal('quotaModal')" style="background:none; font-size:1.5rem;">&times;</button>
            </div>
            
            <div class="add-card-form">
                <div class="form-group">
                    <label>Nombre</label>
                    <input type="text" id="cardNameInput" placeholder="Ej: Visa">
                </div>
                <div class="form-group">
                    <label>Cupo</label>
                    <input type="text" id="cardQuotaInput" oninput="formatCurrencyInput(this)" placeholder="$ 0">
                </div>
                <button class="btn-primary" onclick="saveCard()" id="btnSaveCard" style="height: 46px; width: auto; padding: 0 20px;"><i class="fas fa-plus"></i></button>
                <input type="hidden" id="editCardId">
            </div>

            <div id="quotaListContainer" style="max-height: 300px; overflow-y: auto;"></div>
        </div>
    </div>

    <div id="toastContainer"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // CONFIGURACIÃ“N FIREBASE (Misma v2.5)
        const firebaseConfig = {
            apiKey: "AIzaSyAP8f9ldzgyKAg74Da2yYL9u_urRLtf8nY",
            authDomain: "crm-financiero.firebaseapp.com",
            projectId: "crm-financiero",
            storageBucket: "crm-financiero.firebasestorage.app",
            messagingSenderId: "442754442943",
            appId: "1:442754442943:web:914d5a8ef619d77407880a",
            measurementId: "G-5EBSSNG8P9"
        };

        if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
        const db = firebase.firestore();

        // VARIABLES Y LOGICA (Misma v2.5)
        let transactions = [];
        let cardsList = [];
        let editingTransactionId = null;
        let chartInstance = null;
        let trendChartInstance = null;
        let tempTransactionData = null;
        let globalDeudaPorTarjeta = {};
        let currentViewDate = new Date();

        // CategorÃ­as
        const categorias = {
            gasto: {
                'vivienda': { icon: 'ðŸ ', subcategorias: ['Arriendo', 'Cuota hipoteca', 'AdministraciÃ³n', 'Impuesto predial', 'Reparaciones', 'Muebles y electrodomÃ©sticos'] },
                'servicios_publicos': { icon: 'ðŸ’¡', subcategorias: ['EnergÃ­a elÃ©ctrica', 'Agua y alcantarillado', 'Gas natural', 'Internet', 'TelefonÃ­a mÃ³vil', 'TV por cable/streaming'] },
                'alimentacion': { icon: 'ðŸ”', subcategorias: ['Mercado semanal', 'Carnes y pescados', 'Frutas y verduras', 'PanaderÃ­a', 'Tienda de barrio', 'Domicilios'] },
                'transporte': { icon: 'ðŸš—', subcategorias: ['Transporte pÃºblico', 'Gasolina', 'SOAT', 'RevisiÃ³n tÃ©cnico-mecÃ¡nica', 'Mantenimiento vehÃ­culo', 'Parqueadero', 'Peajes', 'Uber/Taxi'] },
                'educacion': { icon: 'ðŸ“š', subcategorias: ['PensiÃ³n escolar', 'Universidad', 'Ãštiles escolares', 'Uniformes', 'Transporte escolar', 'Cursos/academias', 'Libros'] },
                'salud': { icon: 'âš•ï¸', subcategorias: ['Medicina prepagada', 'Consultas mÃ©dicas', 'Medicamentos', 'OdontologÃ­a', 'ExÃ¡menes', 'Ã“ptica', 'EPS copagos'] },
                'vestuario': { icon: 'ðŸ‘•', subcategorias: ['Ropa adultos', 'Ropa niÃ±os', 'Calzado', 'Ropa interior', 'Accesorios'] },
                'cuidado_personal': { icon: 'ðŸ’„', subcategorias: ['PeluquerÃ­a/barberÃ­a', 'Productos de aseo', 'CosmÃ©ticos', 'Gym/deporte'] },
                'entretenimiento': { icon: 'ðŸŽ¬', subcategorias: ['Restaurantes', 'Cine', 'Paseos/turismo', 'Eventos/conciertos', 'Parques de diversiones', 'Streaming (Netflix, etc.)'] },
                'deudas': { icon: 'ðŸ’³', subcategorias: ['PrÃ©stamos bancarios', 'CrÃ©ditos de libre inversiÃ³n', 'PrÃ©stamos familiares', 'Gota a gota'] }, 
                'seguros': { icon: 'ðŸ›¡ï¸', subcategorias: ['Seguro de vida', 'Seguro hogar', 'Seguro vehÃ­culo', 'SOAT'] },
                'otros': { icon: 'ðŸ“¦', subcategorias: ['Mascotas', 'Regalos', 'Donaciones/diezmos', 'Imprevistos', 'Otros gastos'] }
            },
            ingreso: {
                'salario': { icon: 'ðŸ’¼', subcategorias: ['Salario principal', 'Horas extras', 'Bonificaciones', 'Prima', 'CesantÃ­as'] },
                'negocio': { icon: 'ðŸª', subcategorias: ['Ventas', 'Servicios profesionales', 'Comisiones', 'Arriendos'] },
                'inversiones': { icon: 'ðŸ“ˆ', subcategorias: ['Dividendos', 'Intereses', 'Ganancias de capital'] },
                'otros': { icon: 'ðŸ’°', subcategorias: ['Subsidios estatales', 'PensiÃ³n', 'Regalos/donaciones', 'Otros ingresos'] }
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            document.getElementById('dashboardMonth').value = `${yyyy}-${mm}`;
            document.getElementById('fecha').valueAsDate = today;
            
            document.getElementById('creditModal').style.display = 'none';
            document.getElementById('quotaModal').style.display = 'none';

            loadCards();
        });

        // --- NAVIGATION LOGIC ---
        function switchView(viewId, btnElement) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + viewId).classList.add('active');

            // Update Desktop Sidebar
            document.querySelectorAll('.sidebar .nav-item').forEach(el => el.classList.remove('active'));
            const desktopNavs = document.querySelectorAll('.sidebar .nav-item');
            if(viewId === 'dashboard') desktopNavs[0].classList.add('active');
            if(viewId === 'transacciones') desktopNavs[1].classList.add('active');
            if(viewId === 'estadisticas') desktopNavs[2].classList.add('active');
            if(viewId === 'historial') desktopNavs[3].classList.add('active');

            // Update Mobile Nav
            document.querySelectorAll('.mobile-nav .mob-link').forEach(el => el.classList.remove('active'));
            const mobNavs = document.querySelectorAll('.mobile-nav .mob-link');
            if(viewId === 'dashboard') mobNavs[0].classList.add('active');
            if(viewId === 'transacciones') mobNavs[1].classList.add('active');
            if(viewId === 'estadisticas') mobNavs[2].classList.add('active');
            if(viewId === 'historial') mobNavs[3].classList.add('active');
            
            const titles = {
                'dashboard': 'Resumen Financiero',
                'transacciones': 'Registrar Movimiento',
                'estadisticas': 'AnÃ¡lisis & Tendencias',
                'historial': 'Historial de Movimientos'
            };
            document.getElementById('pageTitle').textContent = titles[viewId];
        }

        function goToAddTransaction() {
            switchView('transacciones', null);
        }

        // --- CORE LOGIC ---
        function formatCurrencyInput(input) {
            let value = input.value.replace(/\D/g, "");
            if (value === "") { input.value = ""; return; }
            const formatted = new Intl.NumberFormat('es-CO').format(value);
            input.value = "$ " + formatted;
        }

        function parseCurrencyInput(valueString) {
            if (!valueString) return 0;
            return parseFloat(valueString.replace(/\D/g, ''));
        }

        function updateDashboardView() {
            const pickerVal = document.getElementById('dashboardMonth').value;
            if(pickerVal) {
                const [year, month] = pickerVal.split('-');
                currentViewDate = new Date(parseInt(year), parseInt(month) - 1, 1);
                updateDashboard();
            }
        }

        // CARDS LOGIC
        async function loadCards() {
            try {
                const snapshot = await db.collection('cards').orderBy('name').get();
                cardsList = [];
                snapshot.forEach(doc => cardsList.push({ id: doc.id, ...doc.data() }));
                if (cardsList.length === 0) { await seedDefaultCards(); return; }
                populateCardSelects();
                loadTransactions();
            } catch (error) { console.error(error); }
        }

        async function seedDefaultCards() {
            const defaults = ['Exito', 'Nu', 'Falabella'];
            const batch = db.batch();
            defaults.forEach(name => batch.set(db.collection('cards').doc(), { name, quota: 0 }));
            await batch.commit(); loadCards();
        }

        function populateCardSelects() {
            const s1 = document.getElementById('tarjetaCredito');
            const s2 = document.getElementById('tarjetaDestinoPago');
            s1.innerHTML = ''; s2.innerHTML = '';
            cardsList.forEach(c => {
                s1.add(new Option(c.name, c.name));
                s2.add(new Option(c.name, c.name));
            });
        }

        // CARD MANAGEMENT MODAL UI
        function openQuotaModal() {
            renderQuotaCards(); resetCardForm();
            document.getElementById('quotaModal').style.display = 'flex';
        }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function resetCardForm() {
            document.getElementById('cardNameInput').value = '';
            document.getElementById('cardQuotaInput').value = '';
            document.getElementById('editCardId').value = '';
            document.getElementById('btnSaveCard').innerHTML = '<i class="fas fa-plus"></i>';
        }

        async function saveCard() {
            const name = document.getElementById('cardNameInput').value.trim();
            const quota = parseCurrencyInput(document.getElementById('cardQuotaInput').value);
            const id = document.getElementById('editCardId').value;
            if(!name) return;
            try {
                if (id) await db.collection('cards').doc(id).update({ name, quota });
                else await db.collection('cards').add({ name, quota });
                resetCardForm(); loadCards(); setTimeout(renderQuotaCards, 500);
            } catch(e) { console.error(e); }
        }

        async function deleteCard(id) {
            if(!confirm("Borrar tarjeta?")) return;
            await db.collection('cards').doc(id).delete();
            loadCards(); setTimeout(renderQuotaCards, 500);
        }
        
        function editCard(id, name, quota) {
            document.getElementById('cardNameInput').value = name;
            const i = document.getElementById('cardQuotaInput');
            i.value = quota; formatCurrencyInput(i);
            document.getElementById('editCardId').value = id;
            document.getElementById('btnSaveCard').innerHTML = '<i class="fas fa-save"></i>';
        }

        function renderQuotaCards() {
            const div = document.getElementById('quotaListContainer');
            div.innerHTML = '';
            cardsList.forEach(c => {
                const debt = globalDeudaPorTarjeta[c.name] || 0;
                const avail = (c.quota || 0) - debt;
                const el = document.createElement('div');
                el.className = 'quota-card';
                el.innerHTML = `
                    <div class="quota-header">
                        <span class="quota-name">${c.name}</span>
                        <div>
                            <button class="btn-icon-action" style="color:var(--info)" onclick="editCard('${c.id}','${c.name}','${c.quota}')"><i class="fas fa-pencil-alt"></i></button>
                            <button class="btn-icon-action" style="color:var(--danger)" onclick="deleteCard('${c.id}')"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                    <div class="quota-details">
                        <span>Cupo: ${formatMoney(c.quota)}</span>
                        <span class="text-danger">Deuda: ${formatMoney(debt)}</span>
                    </div>
                    <div style="font-size:0.8rem; text-align:right; color:var(--success);">Disp: ${formatMoney(avail)}</div>
                `;
                div.appendChild(el);
            });
        }

        // TRANSACTION LOGIC
        function handleTipoChange() {
            const t = document.getElementById('tipo').value;
            const cc = document.getElementById('creditConfig');
            const pc = document.getElementById('divPagoTarjeta');
            const mp = document.getElementById('metodoPagoDiv');
            const md = document.getElementById('metodoDestinoDiv');
            const cat = document.getElementById('categoria');

            cc.classList.add('hidden'); pc.classList.add('hidden'); 
            mp.classList.remove('hidden'); md.classList.add('hidden');
            
            if(t === 'credito') { cc.classList.remove('hidden'); mp.classList.add('hidden'); }
            else if(t === 'pago_tarjeta') { pc.classList.remove('hidden'); }
            else if(t === 'transferencia') { md.classList.remove('hidden'); }

            // Categories logic
            cat.innerHTML = '<option value="">Seleccione...</option>';
            document.getElementById('subcategoriaDiv').classList.add('hidden');
            
            if(t === 'pago_tarjeta') cat.add(new Option('Abono Tarjeta', 'pago_tc'));
            else if(t === 'transferencia') cat.add(new Option('Transferencia', 'transferencia'));
            else {
                const group = t === 'credito' ? 'gasto' : t;
                if(categorias[group]) {
                    Object.keys(categorias[group]).forEach(k => {
                        cat.add(new Option(categorias[group][k].icon + ' ' + k.toUpperCase().replace(/_/g,' '), k));
                    });
                }
            }
        }
        
        document.getElementById('categoria').addEventListener('change', function() {
            const t = document.getElementById('tipo').value;
            if(t==='pago_tarjeta'||t==='transferencia') return;
            const k = this.value;
            const sub = document.getElementById('subcategoria');
            const div = document.getElementById('subcategoriaDiv');
            const group = t === 'credito' ? 'gasto' : t;
            
            if(k && categorias[group][k]) {
                div.classList.remove('hidden');
                sub.innerHTML = '';
                categorias[group][k].subcategorias.forEach(s => sub.add(new Option(s,s)));
            } else div.classList.add('hidden');
        });

        function preSubmit() {
            const t = document.getElementById('tipo').value;
            const m = parseCurrencyInput(document.getElementById('monto').value);
            if(m <= 0) { alert('Monto invÃ¡lido'); return; }

            const data = {
                tipo: t, monto: m,
                categoria: document.getElementById('categoria').value,
                subcategoria: document.getElementById('subcategoria').value || '',
                miembro: document.getElementById('miembro').value,
                descripcion: document.getElementById('descripcion').value,
                fecha: document.getElementById('fecha').value,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };

            if(t === 'credito') {
                const tc = document.getElementById('tarjetaCredito').value;
                const c = parseInt(document.getElementById('cuotas').value);
                data.metodoPago = tc; data.esCredito = true; data.cuotas = c;
                data.totalDeuda = m; 
                
                tempTransactionData = data;
                document.getElementById('modalTarjeta').textContent = tc;
                document.getElementById('modalCuotas').textContent = c;
                document.getElementById('modalTotalDeuda').textContent = formatMoney(m);
                document.getElementById('creditModal').style.display = 'flex';
            } else {
                if(t==='pago_tarjeta') {
                    data.metodoPago = document.getElementById('metodoPago').value;
                    data.tarjetaDestino = document.getElementById('tarjetaDestinoPago').value;
                } else {
                    data.metodoPago = document.getElementById('metodoPago').value;
                    if(t==='transferencia') data.metodoDestino = document.getElementById('metodoDestino').value;
                }
                saveTransaction(data);
            }
        }

        function confirmSaveTransaction() {
            if(tempTransactionData) saveTransaction(tempTransactionData);
            closeModal('creditModal');
        }

        async function saveTransaction(data) {
            try {
                if(editingTransactionId) await db.collection('transactions').doc(editingTransactionId).update(data);
                else await db.collection('transactions').add(data);
                cancelEdit(); loadTransactions();
                showToast(editingTransactionId ? 'Actualizado' : 'Guardado', 'success');
            } catch(e) { alert('Error: ' + e.message); }
        }

        function showToast(msg, type) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = msg;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        }

        async function loadTransactions() {
            const s = await db.collection('transactions').orderBy('fecha', 'desc').get();
            transactions = []; s.forEach(d => transactions.push({id:d.id, ...d.data()}));
            updateDashboard(); renderHistory(); renderCharts(); renderTrendChart();
        }

        function updateDashboard() {
            let deb=0, eff=0, neq=0;
            let debtMap = {}; cardsList.forEach(c => debtMap[c.name]=0);
            
            let incMonth=0, expMonth=0;
            const vm = currentViewDate.getMonth();
            const vy = currentViewDate.getFullYear();

            transactions.forEach(t => {
                const m = parseFloat(t.monto);
                const [ty, tm] = t.fecha.split('-').map(Number);
                const isView = (tm-1)===vm && ty===vy;

                if(t.tipo === 'pago_tarjeta') {
                    if(t.metodoPago==='debito') deb-=m;
                    if(t.metodoPago==='efectivo') eff-=m;
                    if(t.metodoPago==='nequi') neq-=m;
                    if(debtMap[t.tarjetaDestino] !== undefined) debtMap[t.tarjetaDestino] -= m;
                } else if(!t.esCredito) {
                    if(t.tipo==='ingreso') {
                        if(t.metodoPago==='debito') deb+=m;
                        if(t.metodoPago==='efectivo') eff+=m;
                        if(t.metodoPago==='nequi') neq+=m;
                        if(isView) incMonth+=m;
                    } else if(t.tipo==='gasto') {
                        if(t.metodoPago==='debito') deb-=m;
                        if(t.metodoPago==='efectivo') eff-=m;
                        if(t.metodoPago==='nequi') neq-=m;
                        if(isView) expMonth+=m;
                    } else if(t.tipo==='transferencia') {
                        if(t.metodoPago==='debito') deb-=m;
                        if(t.metodoPago==='efectivo') eff-=m;
                        if(t.metodoPago==='nequi') neq-=m;
                        if(t.metodoDestino==='debito') deb+=m;
                        if(t.metodoDestino==='efectivo') eff+=m;
                        if(t.metodoDestino==='nequi') neq+=m;
                    }
                } else {
                    const c = t.metodoPago;
                    if(debtMap[c] !== undefined) debtMap[c] += (t.totalDeuda||m);
                    if(isView) expMonth+=m;
                }
            });

            globalDeudaPorTarjeta = debtMap;
            
            document.getElementById('saldoDebito').textContent = formatMoney(deb);
            document.getElementById('saldoEfectivo').textContent = formatMoney(eff);
            document.getElementById('saldoNequi').textContent = formatMoney(neq);
            document.getElementById('saldoTotal').textContent = formatMoney(deb+eff+neq);
            
            document.getElementById('totalIngresosMes').textContent = formatMoney(incMonth);
            document.getElementById('totalGastosMes').textContent = formatMoney(expMonth);
            document.getElementById('balanceMes').textContent = formatMoney(incMonth-expMonth);

            const div = document.getElementById('cardsBreakdown');
            div.innerHTML = '';
            let totalDebt = 0;
            Object.keys(debtMap).forEach(k => {
                if(debtMap[k] !== 0) {
                    totalDebt += debtMap[k];
                    div.innerHTML += `<div class="card-status-item"><span class="card-name">${k}</span><span class="card-debt">${formatMoney(debtMap[k])}</span></div>`;
                }
            });
            document.getElementById('deudaTotalTC').textContent = formatMoney(totalDebt);
        }

        // --- CHARTS ---
        function renderTrendChart() {
            const ctx = document.getElementById('chartTendencias');
            if(trendChartInstance) trendChartInstance.destroy();
            
            const labels = []; const dInc = []; const dExp = [];
            const today = new Date();
            const buckets = {};
            for(let i=5; i>=0; i--){
                const d = new Date(today.getFullYear(), today.getMonth()-i, 1);
                const k = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
                buckets[k] = {in:0, out:0};
                labels.push(d.toLocaleString('es-CO',{month:'short'}));
            }
            transactions.forEach(t=>{
                const k = t.fecha.substring(0,7);
                if(buckets[k]) {
                    if(t.tipo==='ingreso') buckets[k].in += parseFloat(t.monto);
                    else if(t.tipo==='gasto'||t.tipo==='credito') buckets[k].out += parseFloat(t.monto);
                }
            });
            Object.keys(buckets).sort().forEach(k => { dInc.push(buckets[k].in); dExp.push(buckets[k].out); });

            trendChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label:'Ingresos', data:dInc, borderColor:'#10b981', backgroundColor:'rgba(16,185,129,0.1)', fill:true, tension:0.4 },
                        { label:'Gastos', data:dExp, borderColor:'#ef4444', backgroundColor:'rgba(239,68,68,0.1)', fill:true, tension:0.4 }
                    ]
                },
                options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{position:'top'}} }
            });
        }

        function renderCharts() {
            const ctx = document.getElementById('chartCategorias');
            if(chartInstance) chartInstance.destroy();
            const cats = {};
            const vm = currentViewDate.getMonth(); const vy = currentViewDate.getFullYear();
            
            transactions.filter(t => (t.tipo==='gasto'||t.tipo==='credito')).forEach(t => {
                const [ty, tm] = t.fecha.split('-').map(Number);
                if((tm-1)===vm && ty===vy) {
                    const c = t.categoria || 'Otros';
                    cats[c] = (cats[c]||0) + parseFloat(t.monto);
                }
            });

            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(cats),
                    datasets: [{ data: Object.values(cats), backgroundColor: ['#6366f1','#ec4899','#10b981','#f59e0b','#3b82f6','#8b5cf6'] }]
                },
                options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{position:'right'}} }
            });
        }

        function renderHistory() {
            const b = document.getElementById('transactionList');
            b.innerHTML = '';
            transactions.slice(0, 50).forEach(t => { 
                let color = t.tipo==='ingreso'?'text-success':(t.tipo==='pago_tarjeta'?'text-credit':'text-danger');
                let symbol = t.tipo==='ingreso'?'+':'-';
                if(t.tipo==='transferencia') { color='text-main'; symbol=''; }
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${t.fecha}</td>
                    <td style="text-transform:capitalize;">${t.tipo.replace('_',' ')}</td>
                    <td>${t.categoria}</td>
                    <td>${t.descripcion}</td>
                    <td class="${color}" style="font-weight:bold;">${symbol} ${formatMoney(t.monto)}</td>
                    <td>
                        <button onclick="editTransaction('${t.id}')" class="btn-icon-action" style="color:var(--info);"><i class="fas fa-edit"></i></button>
                        <button onclick="deleteTransaction('${t.id}')" class="btn-icon-action" style="color:var(--danger);"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                b.appendChild(tr);
            });
        }

        // --- EDIT LOGIC (RESTORED) ---
        window.editTransaction = function(id) {
            const t = transactions.find(x => x.id === id);
            if (!t) return;
            
            editingTransactionId = id;
            
            // 1. Switch to Form View
            switchView('transacciones', document.querySelector('.sidebar .nav-item:nth-child(2)'));
            
            // 2. Set Values
            document.getElementById('tipo').value = t.tipo;
            handleTipoChange(); // Refresh visibility
            
            const mInput = document.getElementById('monto');
            mInput.value = t.monto;
            formatCurrencyInput(mInput); // Apply mask

            document.getElementById('descripcion').value = t.descripcion;
            document.getElementById('fecha').value = t.fecha;
            document.getElementById('miembro').value = t.miembro;

            // 3. Conditionals
            if (t.tipo === 'credito') {
                document.getElementById('tarjetaCredito').value = t.metodoPago;
                document.getElementById('cuotas').value = t.cuotas;
            } else if (t.tipo === 'pago_tarjeta') {
                document.getElementById('metodoPago').value = t.metodoPago;
                document.getElementById('tarjetaDestinoPago').value = t.tarjetaDestino;
            } else {
                document.getElementById('metodoPago').value = t.metodoPago;
                if(t.tipo === 'transferencia') document.getElementById('metodoDestino').value = t.metodoDestino;
            }

            // 4. Update UI Text
            document.getElementById('formTitle').textContent = 'Editar TransacciÃ³n';
            document.getElementById('btnSubmitText').textContent = 'Actualizar TransacciÃ³n';
            document.getElementById('btnCancelar').classList.remove('hidden');

            // 5. Load Categories (Delayed to allow DOM update)
            setTimeout(() => {
                document.getElementById('categoria').value = t.categoria;
                const event = new Event('change');
                document.getElementById('categoria').dispatchEvent(event);
                setTimeout(() => { if(t.subcategoria) document.getElementById('subcategoria').value = t.subcategoria; }, 50);
            }, 100);
        }

        function formatMoney(n) { return '$ ' + parseFloat(n).toLocaleString('es-CO', {maximumFractionDigits:0}); }
        function cancelEdit() { 
            editingTransactionId = null; document.getElementById('transactionForm').reset();
            document.getElementById('formTitle').textContent = 'Nueva TransacciÃ³n';
            document.getElementById('btnCancelar').classList.add('hidden');
            document.getElementById('btnSubmitText').textContent = 'Guardar TransacciÃ³n';
            handleTipoChange();
        }
        window.deleteTransaction = async function(id) {
            if(confirm("Eliminar?")) { await db.collection('transactions').doc(id).delete(); loadTransactions(); showToast('Eliminado', 'success'); }
        }
        
        handleTipoChange();
    </script>
</body>
</html>